<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Color Catcher</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define the font for a modern look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the pointer/crosshair on the canvas */
        .color-canvas {
            cursor: crosshair;
            display: block;
            max-width: 100%;
            height: auto;
            border: 4px solid #10b981; /* Emerald border for captured image */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        /* Style for the video feed before capture */
        #videoFeed {
            display: block;
            max-width: 100%;
            height: auto;
            object-fit: contain;
            border: 4px solid #6366f1; /* Indigo border for live feed */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl space-y-6">
        <h1 class="text-3xl font-extrabold text-gray-900 text-center">
            ðŸ“¸ Color Catcher test
        </h1>
        <p class="text-center text-gray-600">
            Click 'Start Camera' to begin, 'Capture Photo' to freeze the image, then click anywhere on the photo to sample the color code.
        </p>

        <div class="flex flex-col items-center space-y-4">

       
            <video id="videoFeed" class="w-full rounded-lg" autoplay playsinline muted hidden></video>


            <canvas id="colorCanvas" class="color-canvas w-full rounded-lg" style="display: none;"></canvas>

   
            <div id="statusMessage" class="w-full text-center p-3 rounded-lg text-sm bg-blue-100 text-blue-700 font-medium">
                Waiting for user action...
            </div>
        </div>

        <!-- Controls -->
        <div class="flex justify-center space-x-4 pt-4">
            <button id="startCameraButton" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full hover:bg-indigo-700 transition duration-150 shadow-lg">
                Start Camera
            </button>
            <button id="captureButton" class="px-6 py-3 bg-emerald-500 text-white font-semibold rounded-full hover:bg-emerald-600 transition duration-150 shadow-lg" disabled>
                Capture Photo
            </button>
            <button id="resetButton" class="px-6 py-3 bg-gray-400 text-white font-semibold rounded-full hover:bg-gray-500 transition duration-150 shadow-lg" disabled>
                Reset
            </button>
        </div>

        <!-- Color Output Area -->
        <div class="pt-8 space-y-4">
            <h2 class="text-xl font-bold text-gray-800">
                Picked Color
            </h2>
            <div class="flex items-center space-x-4 bg-gray-100 p-4 rounded-xl border border-gray-200">
                <!-- Visual Color Swatch -->
                <div id="colorSwatch" class="w-16 h-16 rounded-lg border-2 border-gray-300 transition-all duration-300" style="background-color: #FFFFFF;"></div>

                <!-- Color Code Display -->
                <div>
                    <span class="text-sm font-medium text-gray-500">HEX Code:</span>
                    <p id="hexCodeDisplay" class="text-2xl font-mono font-bold text-gray-800 select-all">#FFFFFF</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global references
        const video = document.getElementById('videoFeed');
        const canvas = document.getElementById('colorCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startCameraButton');
        const captureButton = document.getElementById('captureButton');
        const resetButton = document.getElementById('resetButton');
        const statusMessage = document.getElementById('statusMessage');
        const colorSwatch = document.getElementById('colorSwatch');
        const hexCodeDisplay = document.getElementById('hexCodeDisplay');

        let stream = null; // To hold the camera stream globally
        let isCaptured = false; // State flag

        // Utility function to convert RGB to Hex
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        }

        // Function to update the status message
        function updateStatus(text, type = 'info') {
            const classes = {
                'info': 'bg-blue-100 text-blue-700',
                'success': 'bg-green-100 text-green-700',
                'error': 'bg-red-100 text-red-700'
            };
            statusMessage.className = `w-full text-center p-3 rounded-lg text-sm font-medium ${classes[type]}`;
            statusMessage.textContent = text;
        }

        // --- Step 1: Start Camera Access ---
        startButton.addEventListener('click', async () => {
            try {
                // Request access to the user's camera (video only)
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = stream;
                video.hidden = false;
                canvas.style.display = 'none';
                isCaptured = false;

                // Wait for the video to load metadata (including intrinsic size)
                await new Promise(resolve => video.onloadedmetadata = resolve);
                video.play();

                updateStatus('Camera feed active. Click "Capture Photo" when ready.', 'success');
                startButton.disabled = true;
                captureButton.disabled = false;
                resetButton.disabled = false;

                // Reset color picker state
                colorSwatch.style.backgroundColor = '#FFFFFF';
                hexCodeDisplay.textContent = '#FFFFFF';

            } catch (err) {
                console.error('Error accessing camera:', err);
                updateStatus('Camera access denied or failed. Check permissions.', 'error');
                startButton.disabled = false;
                captureButton.disabled = true;
                resetButton.disabled = true;
                video.hidden = true;
            }
        });

        // --- Step 2: Capture Image ---
        captureButton.addEventListener('click', () => {
            if (!stream || !video.srcObject) {
                updateStatus('Please start the camera first.', 'error');
                return;
            }

            // Set canvas dimensions to match the video feed
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Draw the current video frame onto the canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Stop the video stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }

            // Toggle visibility
            video.hidden = true;
            canvas.style.display = 'block';
            isCaptured = true;

            updateStatus('Photo captured. Click on the image to pick a color.', 'success');
            captureButton.disabled = true;
            startButton.disabled = true;
        });

        // --- Step 3: Color Catcher Logic (Click Listener) ---
        canvas.addEventListener('click', (event) => {
            if (!isCaptured) return;

            // 1. Calculate click coordinates relative to the canvas
            const rect = canvas.getBoundingClientRect();
            // Get click position relative to the scaled canvas
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const x = Math.floor((event.clientX - rect.left) * scaleX);
            const y = Math.floor((event.clientY - rect.top) * scaleY);

            // 2. Read the pixel data at the coordinates (4 bytes: R, G, B, A)
            try {
                const pixelData = ctx.getImageData(x, y, 1, 1).data;
                const r = pixelData[0];
                const g = pixelData[1];
                const b = pixelData[2];

                const hex = rgbToHex(r, g, b);

                // 3. Display the results
                colorSwatch.style.backgroundColor = hex;
                hexCodeDisplay.textContent = hex;
                updateStatus(`Color captured at (${x}, ${y}): ${hex}. Click to copy!`, 'success');

                // 4. (Simple Zoom/Pointer effect): Draw a crosshair/circle on the canvas
                // To visually confirm the selection point, we'll momentarily draw a red circle.
                // We redraw the whole image first to clear the old marker, but since the
                // image is static, we can just save/restore the context.
                
                // Redraw the original image (or just use save/restore context)
                ctx.putImageData(ctx.getImageData(0, 0, canvas.width, canvas.height), 0, 0);

                // Draw the pointer
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI); // 5-pixel radius circle
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.strokeStyle = '#FF0000'; // Red dot in the center
                ctx.lineWidth = 1;
                ctx.stroke();

            } catch (e) {
                console.error("Error reading image data:", e);
                updateStatus('Could not read pixel data. Ensure the image is fully drawn.', 'error');
            }
        });

        // --- Copy to Clipboard on Click ---
        hexCodeDisplay.addEventListener('click', () => {
             // Use document.execCommand('copy') for compatibility in environments like this iframe
            const textToCopy = hexCodeDisplay.textContent;
            const tempInput = document.createElement('input');
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            
            try {
                document.execCommand('copy');
                updateStatus(`Copied ${textToCopy} to clipboard!`, 'info');
            } catch (err) {
                updateStatus('Failed to copy to clipboard.', 'error');
                console.error('Copy failed:', err);
            }
            document.body.removeChild(tempInput);
        });

        // --- Reset Button ---
        resetButton.addEventListener('click', () => {
            // Stop stream if active
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.srcObject = null;
            }

            // Reset UI state
            video.hidden = true;
            canvas.style.display = 'none';
            canvas.width = 1;
            canvas.height = 1;
            isCaptured = false;

            startButton.disabled = false;
            captureButton.disabled = true;
            resetButton.disabled = true;

            colorSwatch.style.backgroundColor = '#FFFFFF';
            hexCodeDisplay.textContent = '#FFFFFF';
            updateStatus('App reset. Click "Start Camera" to begin again.');
        });
        
    </script>
</body>
</html>
